---
pcx_content_type: how-to
title: Diagnostic logs
sidebar:
  order: 1
head:
  - tag: title
    content: Tunnel diagnostic logs
---

import {Details} from "~/components";

Cloudflare Tunnel generates a set of diagnostic logs that can be used to troubleshoot issues with `cloudflared`. A diagnostic report collects data from a single instance of `cloudflared` running on the local machine.

## Get diagnostic logs

The steps for getting diagnostic logs depend on your `cloudflared` deployment environment.

### Prerequisites

- Access to the `cloudflared` host being diagnosed
- `cloudflared` version 2024.12.2 or later

### Host environment

These instructions apply to remotely-managed and locally-managed tunnels running directly on the host machine.

1. (Linux only) Allow the `cloudflared` user to create RAW and PACKET sockets without root permissions:

		```sh
		sudo setcap cap_net_raw+ep /usr/bin/traceroute && sudo setcap cap_net_raw+ep /usr/bin/traceroute
		```

2. Get diagnostic logs:

		```sh
		cloudflared tunnel diag
		```

		If multiple instances of `cloudflared` are running on the same host, specify the [metrics server IP and port](/cloudflare-one/connections/connect-networks/monitor-tunnels/metrics/#check-the-metrics-server-address) for the instance you want to diagnose. For example:

		```sh
		cloudflared tunnel diag --metrics 127.0.0.1:20241
		```

This command will output the status of each diagnostic task and place a `cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip` file in your working directory.

### Docker

`cloudflared` reads diagnostic data from the [tunnel metrics server](/cloudflare-one/connections/connect-networks/monitor-tunnels/metrics/). Therefore, the metrics server must be exposed from the Docker container and reachable from the host machine.

1. Determine the tunnel's [metrics server IP and port](/cloudflare-one/connections/connect-networks/monitor-tunnels/metrics/#check-the-metrics-server-address). In Docker environments, the default IP and port is `0.0.0.0:20241`.

2. On the host machine, verify that you can reach the metrics server address. For example, if the metrics server is listening at `0.0.0.0:20241`, run the following command:

		```curl
		curl localhost:20241/diag/tunnel
		```

		This command should return a JSON:
		```json
		{
			"tunnelID": "ef96b330-a7f5-4bce-a00e-827ce5be077f",
			"connectorID": "d236670a-9f74-422f-adf1-030f5c5f0523",
			"connections": [
				{ "isConnected": true, "protocol": 1, "edgeAddress": "198.41.192.167"},
				{"isConnected": true, "protocol": 1, "edgeAddress": "198.41.200.113", "index": 1},
				{"isConnected": true, "protocol": 1, "edgeAddress": "198.41.192.47", "index": 2},
				{"isConnected": true, "protocol": 1, "edgeAddress": "198.41.200.73", "index": 3}
			],
			"icmp_sources": ["192.168.1.243", "fe80::c59:bd4a:e815:ed6"]
		}
		```

3. If the metrics server is unreachable, deploy the container again with port forwarding enabled. The diagnostic feature will try to request information from the Docker instance using ports `20241` to `20245`. You will need to forward one of these diagnostic ports to the metrics port.

		```sh
		docker run -d -p <diagnostic_port>:<metrics_port> docker.io/cloudflare/cloudflared tunnel ...
		```

		- `<diagnostic_port>` is any port in the range `20241` to `20245`.
		- `<metrics_port>` is the metrics port for the `cloudflared` instance you want to diagnose (obtained in Step 1).

3. Take note of the Docker container ID and then run the diagnostic:

		```sh
		cloudflared tunnel diag --diag-container-id=<containerID>
		```

		Alternatively, you can specify the container's name instead of its ID:
		```sh
		cloudflared tunnel diag --diag-container-id=<containerName>
		```

This command will output the status of each diagnostic task and place a `cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip` file in your working directory.

### Kubernetes

The diagnostic feature will request data from the [tunnel metrics server](/cloudflare-one/connections/connect-networks/monitor-tunnels/metrics/#check-the-metrics-server-address) using ports `20241` to `20245`. You will need to use port forwarding to allow the local `cloudflared` instance to connect to the metrics server on one of these ports.


1. Determine the tunnel's [metrics server IP and port](/cloudflare-one/connections/connect-networks/monitor-tunnels/metrics/#check-the-metrics-server-address). In Kubernetes deployments, the default IP and port is `0.0.0.0:20241`.

2. Enable port forwarding:

		```sh
		kubectl port-forward <pod> <diagnostic_port>:<metrics_port>
		```

		- `<pod>`: Name of the pod where the tunnel is running
		- `<diagnostic_port>` is any port in the range `20241` to `20245`.
		- `<metrics_port>` is the metrics port for the `cloudflared` instance you want to diagnose (obtained in Step 1).

		For example, if you set the metrics server address to `0.0.0.0:12345`:

		```sh
		kubectl port-forward http-echo-6d4897585b-r8kfz 20244:12345
		```
		Connections made to local port `20244` are forwarded to port `1234` of the pod that is running the tunnel.

3. Run the diagnostic:

		```sh
		cloudflared tunnel diag --diag-pod-id=<podID>
		```

		If the pod has multiple applications/services running and `cloudflared` is not the first in the pod, you must specify either the container ID or name:

		```sh
		cloudflared tunnel diag --diag-pod-id=<podID> --diag-container-id=<containerName>
		```

This command will output the status of each diagnostic task and place a `cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip` file in your working directory.

## cloudflared-diag files

The `cloudflared-diag-YYYY-MM-DDTHH-MM-SS.zip` archive contains the files listed below. The data in a file either applies to the `cloudflared` instance being diagnosed (`diagnosee`) or the instance that triggered the diagnosis (`diagnoser`). For example, if your tunnel is running in a Docker container, the diagnosee is the Docker instance and the diagnoser is the host machine instance. The diagnosee and diagnoser could also be the same instance.

| File name  | Description | Instance |
| -| - | - |
| | | |
